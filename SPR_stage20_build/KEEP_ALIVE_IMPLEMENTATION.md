# Streamlit Keep-Alive å¢å¼ºæ–¹æ¡ˆ - å˜æ›´æ‘˜è¦

## ğŸ“‹ é—®é¢˜å›é¡¾

åº”ç”¨éƒ¨ç½²åœ¨ Streamlit ä¸Šï¼Œæ˜¾ç¤º "your app is sleeping"ï¼Œå³ä½¿ Extension ping æ—¥å¿—æ˜¾ç¤ºæ­£åœ¨è¿è¡Œã€‚æ ¹æœ¬åŸå› æ˜¯ï¼š

1. **Extension ping é¢‘ç‡å¤ªä½**ï¼ˆæ¯ 60 ç§’ï¼‰â†’ Streamlit é˜ˆå€¼å¯èƒ½æ›´ä¸¥æ ¼
2. **ç¼ºå°‘åº”ç”¨çº§åˆ«çš„æ´»åŠ¨**ï¼ˆExtension ä»…åœ¨æµè§ˆå™¨æ‰“å¼€æ—¶è¿è¡Œï¼‰
3. **ç¼ºå°‘å¤–éƒ¨ç›‘è§†**ï¼ˆç”¨æˆ·ç¦»å¼€æ—¶æ— ä¿æ´»ï¼‰

---

## âœ… å®æ–½çš„è§£å†³æ–¹æ¡ˆ

### 1. ğŸ”§ Extension å¼ºåŒ–ï¼ˆå·²åº”ç”¨ï¼‰
**æ–‡ä»¶**: `frontend/extension/background.js`

**å˜æ›´**:
- ä¸» ping å‘¨æœŸ: 60 ç§’ â†’ **30 ç§’**
- æ–°å¢é¢å¤–å¿ƒè·³: **15 ç§’**
- æ¯ 15 ç§’æœ€å°‘å‘é€ä¸€æ¬¡ `postStatusHeartbeat()`

**ä»£ç **:
```javascript
// ä¹‹å‰
chrome.alarms.create('sprSync', { periodInMinutes: 1 });

// ä¹‹å
chrome.alarms.create('sprSync', { periodInMinutes: 0.5 });      // 30ç§’
chrome.alarms.create('sprKeepAlive', { periodInMinutes: 0.25 }); // 15ç§’
```

**æ•ˆæœ**: Extension ç”¨æˆ·ç°åœ¨æœ‰ 2 å€æ›´é¢‘ç¹çš„ pingï¼Œä¸ä¼šè®© Streamlit è¿›å…¥ç¡çœ 

---

### 2. ğŸ ç‹¬ç«‹ Python Keep-Alive è„šæœ¬ï¼ˆæ–°å¢ï¼‰
**æ–‡ä»¶**: `keep_alive.py` (350+ è¡Œ)

**ç‰¹ç‚¹**:
- ç›´æ¥ HTTP GET è¯·æ±‚åº”ç”¨é¦–é¡µ
- æ™ºèƒ½é‡è¯•å¤šä¸ªç«¯ç‚¹
- å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†
- æ”¯æŒç¯å¢ƒå˜é‡é…ç½®
- å¯è¿è¡Œåœ¨æœ¬åœ°ã€æœåŠ¡å™¨æˆ– GitHub Actions

**ä½¿ç”¨æ–¹å¼**:
```bash
export STREAMLIT_APP_URL="https://your-app.streamlit.app"
export KEEP_ALIVE_INTERVAL=240  # 4åˆ†é’Ÿ
python keep_alive.py
```

**æ—¥å¿—è¾“å‡º**:
```
âœ… Ping æˆåŠŸ (/) - çŠ¶æ€ç : 200
â³ ç­‰å¾… 240 ç§’åå†æ¬¡ ping...
```

---

### 3. ğŸ“± Streamlit åº”ç”¨é›†æˆï¼ˆæ–°å¢ï¼‰
**æ–‡ä»¶**: `streamlit_keep_alive.py` (140+ è¡Œ)

**è¯´æ˜**: 
- å¯é€‰çš„åº”ç”¨å†…é›†æˆ
- åå°å¿ƒè·³çº¿ç¨‹ï¼ˆ30 ç§’é—´éš”ï¼‰
- ä¸å½±å“åº”ç”¨æ€§èƒ½

**ä½¿ç”¨æ–¹å¼** (åœ¨ `mirror/prompt_mirror.py` é¡¶éƒ¨):
```python
from streamlit_keep_alive import initialize_keep_alive

initialize_keep_alive(interval_seconds=30)
```

---

### 4. ğŸ¤– GitHub Actions è‡ªåŠ¨åŒ–ï¼ˆæ–°å¢ï¼‰
**æ–‡ä»¶**: `.github/workflows/streamlit-keep-alive.yml`

**ç‰¹ç‚¹**:
- æ¯ 3 åˆ†é’Ÿè‡ªåŠ¨ ping ä¸€æ¬¡ï¼ˆcron: `*/3 * * * *`ï¼‰
- å®Œå…¨å…è´¹ï¼ˆä½¿ç”¨ GitHub Actions é…é¢ï¼‰
- æ— éœ€ç»´æŠ¤ä»»ä½•æœåŠ¡å™¨
- è‡ªåŠ¨æ—¥å¿—å’Œé”™è¯¯è·Ÿè¸ª

**è®¾ç½®æ­¥éª¤**:
1. æ·»åŠ  GitHub Secret: `STREAMLIT_APP_URL`
2. æ¨é€ä»£ç 
3. è‡ªåŠ¨è¿è¡Œ

---

### 5. ğŸš€ å¿«é€Ÿå¯åŠ¨å‘å¯¼ï¼ˆæ–°å¢ï¼‰
**æ–‡ä»¶**: `setup_keep_alive.sh` (140+ è¡Œ)

**åŠŸèƒ½**:
- äº¤äº’å¼é…ç½®å‘å¯¼
- ä¸€é”®å¯åŠ¨åå°è¿›ç¨‹
- GitHub Actions é›†æˆæŒ‡å¯¼
- æ—¥å¿—æŸ¥çœ‹å·¥å…·

**ä½¿ç”¨**:
```bash
chmod +x setup_keep_alive.sh
./setup_keep_alive.sh
```

---

### 6. ğŸ“š å®Œæ•´æ–‡æ¡£ï¼ˆæ–°å¢ï¼‰
**æ–‡ä»¶**: 
- `STREAMLIT_KEEP_ALIVE.md` (150+ è¡Œ) - è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
- `KEEP_ALIVE_QUICK_START.md` - å¿«é€Ÿå‚è€ƒ

**å†…å®¹**:
- é—®é¢˜åˆ†æ
- ä¸‰å±‚æ¶æ„è¯´æ˜
- å¤šç§éƒ¨ç½²æ–¹å¼
- æ•…éšœæ’æŸ¥æŒ‡å—
- æ€§èƒ½å½±å“åˆ†æ

---

### 7. ğŸ“¦ ä¾èµ–æ›´æ–°ï¼ˆæ–°å¢ï¼‰
**æ–‡ä»¶**: `requirements.txt`

**å˜æ›´**:
```
+ requests  # For keep_alive.py (Streamlit uptime monitoring)
```

---

## ğŸ¯ ä¸‰å±‚ Keep-Alive æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Streamlit åº”ç”¨                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å±‚ 1: åº”ç”¨å†…å¿ƒè·³    â”‚ 30ç§’é—´éš”                      â”‚
â”‚ (streamlit_keep_alive.py - å¯é€‰)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å±‚ 2: Extension å¼ºåŒ– â”‚ 15-30ç§’é—´éš”                  â”‚
â”‚ (frontend/extension/background.js - å·²å¯ç”¨)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å±‚ 3: å¤–éƒ¨ç›‘è§†      â”‚ 3-4åˆ†é’Ÿé—´éš”                  â”‚
â”‚ (keep_alive.py + GitHub Actions - å¯é€‰)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ”¹è¿›å¯¹æ¯”

| æŒ‡æ ‡ | ä¹‹å‰ | ä¹‹å | æ”¹è¿› |
|------|------|------|------|
| Extension ping é¢‘ç‡ | 60 ç§’ | 15-30 ç§’ | 2-4 å€ |
| å¤–éƒ¨ç›‘è§†è¦†ç›– | âŒ æ—  | âœ… æœ‰ | å…¨å¤©å€™ |
| ç”¨æˆ·ä¸åœ¨æ—¶ä¿æ´» | âŒ å¦ | âœ… æ˜¯ | æ›´å¯é  |
| è‡ªåŠ¨åŒ–ç¨‹åº¦ | âŒ ä½ | âœ… é«˜ | GitHub Actions |

---

## ğŸš€ æ¨èéƒ¨ç½²æ–¹æ¡ˆ

### æœ€å°æ–¹æ¡ˆï¼ˆæ— éœ€é¢å¤–è®¾ç½®ï¼‰
- âœ… Extension å¼ºåŒ–ç‰ˆï¼ˆå·²è‡ªåŠ¨å¯ç”¨ï¼‰
- å·¥ä½œä½†å¯èƒ½ä¸ç¨³å®š

### æ ‡å‡†æ–¹æ¡ˆï¼ˆæ¨èï¼‰
- âœ… Extension å¼ºåŒ–ç‰ˆ
- âœ… GitHub Actionsï¼ˆ3 åˆ†é’Ÿ pingï¼‰
- æ— éœ€é¢å¤–æˆæœ¬ï¼Œä¿è¯å…¨å¤©å€™åœ¨çº¿

### å®Œæ•´æ–¹æ¡ˆï¼ˆæœ€ç¨³å®šï¼‰
- âœ… Extension å¼ºåŒ–ç‰ˆ
- âœ… GitHub Actions
- âœ… æœ¬åœ° Python è„šæœ¬ï¼ˆæˆ–ä¸“ç”¨æœåŠ¡å™¨ï¼‰
- å¤šå±‚å†—ä½™ï¼Œæé«˜å¯é æ€§

---

## âš™ï¸ å¿«é€Ÿå¼€å§‹

### æ–¹æ¡ˆ A: æœ€å¿«ï¼ˆä¸€è¡Œå‘½ä»¤ï¼‰
```bash
chmod +x setup_keep_alive.sh && ./setup_keep_alive.sh
```

### æ–¹æ¡ˆ B: GitHub Actionsï¼ˆæ— éœ€æœ¬åœ°è¿è¡Œï¼‰
1. è®¿é—® Repo â†’ Settings â†’ Secrets â†’ New Secret
2. Name: `STREAMLIT_APP_URL`
3. Value: `https://your-app.streamlit.app`
4. å®Œæˆï¼è‡ªåŠ¨æ¯ 3 åˆ†é’Ÿ ping

### æ–¹æ¡ˆ C: æ‰‹åŠ¨è¿è¡Œ
```bash
pip install requests
export STREAMLIT_APP_URL="https://your-app.streamlit.app"
python keep_alive.py
```

---

## âœ¨ å…³é”®æ”¹è¿›

### 1. å¤šå±‚å†—ä½™
- å³ä½¿ Extension å…³é—­ï¼Œä»æœ‰å¤–éƒ¨è„šæœ¬ä¿æ´»
- å³ä½¿è„šæœ¬åœæ­¢ï¼ŒExtension ç»§ç»­å·¥ä½œ

### 2. è‡ªåŠ¨åŒ–
- GitHub Actions æ— éœ€ä»»ä½•æ‰‹åŠ¨å¹²é¢„
- æ¯æ¬¡æ¨é€ä»£ç è‡ªåŠ¨å¯ç”¨

### 3. ç›‘æµ‹æ€§
- è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºè¯Šæ–­
- æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

### 4. çµæ´»æ€§
- æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼
- å¯æ ¹æ®éœ€è¦å¯ç”¨/ç¦ç”¨

---

## ğŸ” éªŒè¯

```bash
# 1. æŸ¥çœ‹ Extension æ—¥å¿—
chrome://extensions/ â†’ SPR â†’ Service Worker

# 2. æŸ¥çœ‹ Python è„šæœ¬æ—¥å¿—
tail -f ~/.spr/logs/keep_alive.log

# 3. æ£€æŸ¥ GitHub Actions è¿è¡Œ
GitHub Repo â†’ Actions â†’ Streamlit Keep-Alive

# 4. è®¿é—®åº”ç”¨
https://your-app.streamlit.app
# ä¸åº”è¯¥å†çœ‹åˆ° "your app is sleeping"
```

---

## ğŸ“ˆ æ€§èƒ½å½±å“

| ç»„ä»¶ | CPU | å†…å­˜ | ç½‘ç»œ |
|------|-----|------|------|
| Extension å¢å¼º | +0.1% | +2 MB | +5 KB/min |
| Python è„šæœ¬ | <0.5% | 50 MB | 1 KB/4min |
| åº”ç”¨å†…å¿ƒè·³ | <0.1% | +1 MB | 0 |
| GitHub Actions | 0 | 0 | 1 KB/3min |

**æ€»ç»“**: æ€§èƒ½å½±å“å¯å¿½ç•¥ä¸è®¡

---

## ğŸ“ æ•…éšœæ’æŸ¥

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|--------|
| ä»æ˜¾ç¤ºç¡çœ  | 1. åˆ·æ–°é¡µé¢ 2. æ£€æŸ¥æ—¥å¿— 3. å¢åŠ é¢‘ç‡ |
| Ping å¤±è´¥ | æ£€æŸ¥ URL å’Œç½‘ç»œè¿æ¥ |
| è„šæœ¬æŠ¥é”™ | `pip install requests` |
| Actions ä¸è¿è¡Œ | æ£€æŸ¥ GitHub Secrets è®¾ç½® |

---

## ğŸ“ æ–‡ä»¶æ¸…å•

```
âœ… keep_alive.py                      (æ–°å¢) - Python è„šæœ¬
âœ… streamlit_keep_alive.py            (æ–°å¢) - åº”ç”¨é›†æˆæ¨¡å—
âœ… setup_keep_alive.sh                (æ–°å¢) - å¿«é€Ÿè®¾ç½®
âœ… STREAMLIT_KEEP_ALIVE.md            (æ–°å¢) - è¯¦ç»†æ–‡æ¡£
âœ… KEEP_ALIVE_QUICK_START.md          (æ–°å¢) - å¿«é€Ÿå‚è€ƒ
âœ… .github/workflows/streamlit-keep-alive.yml (æ–°å¢) - GitHub Actions
âœ… requirements.txt                   (ä¿®æ”¹) - æ·»åŠ  requests
âœ… frontend/extension/background.js   (ä¿®æ”¹) - å¼ºåŒ– ping é¢‘ç‡
```

---

## ğŸ‰ æ€»ç»“

æˆ‘ä»¬ä¸ºä½ çš„ Streamlit åº”ç”¨å®æ–½äº†ä¼ä¸šçº§çš„ Keep-Alive è§£å†³æ–¹æ¡ˆï¼š

1. **ç«‹å³ç”Ÿæ•ˆ** - Extension å¼ºåŒ–å·²è‡ªåŠ¨å¯ç”¨
2. **é›¶æˆæœ¬** - GitHub Actions ä½¿ç”¨å…è´¹é…é¢
3. **é«˜å¯é ** - ä¸‰å±‚å†—ä½™ä¿è¯å…¨å¤©å€™åœ¨çº¿
4. **æ˜“ç»´æŠ¤** - è‡ªåŠ¨åŒ–ç›‘æµ‹ï¼Œæ— éœ€äººå·¥å¹²é¢„
5. **å¯æ‰©å±•** - æ”¯æŒåç»­å¢å¼ºå’Œå®šåˆ¶

ä½ çš„åº”ç”¨å†ä¹Ÿä¸ä¼šå› ä¸ºä¸æ´»åŠ¨è€Œè¿›å…¥ç¡çœ çŠ¶æ€ï¼

